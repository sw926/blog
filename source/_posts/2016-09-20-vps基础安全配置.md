---
title: vps配置Shadowsocks
date: 2016-09-20 11:53:13
tags:
    - ss
category: Other
---
# 添加一个普通用户
```
useradd xxx
passwd xxx
```
设置用户文件夹

```
chown xxx /home/xxx
```
上传ssh公钥

客户端

```
scp ~/.ssh/id_rsa.pub xxx@{host}:~/
```
服务器端

```
mkdir .ssh

mv id_rsa.pub .ssh/authorized_keys
chown -R xxx:xxx .ssh
chmod 700 .ssh
chmod 600 .ssh/authorized_keys
```

# 修改ssh端口号
修改配置文件

```
vi /etc/ssh/sshd_config
```
```
修改端口号：Port xxx
将密码认证设置成NO：PasswordAuthentication no；
同时将root直接登录系统取消：PermitRootLogin no
```
重启ssh服务

```
/etc/init.d/ssh restart
```
添加ssh快捷登录，在~/.ssh/config(没有就创建)加入

```
Host xxx
  hostname 111.111.111.111
  user username
  port 1111

```
# 安装ShadowSoks
参考 <https://github.com/shadowsocks/shadowsocks-libev>
在Ubuntu上可以

```
sudo apt update
sudo apt install shadowsocks-libev
```

自己编译安装

安装git，下载源码

```
apt-get install git -y
git clone https://github.com/madeye/shadowsocks-libev.git
```

## 编译安装

```
cd shadowsocks-libev
sudo apt-get install --no-install-recommends build-essential autoconf libtool libssl-dev \
    gawk debhelper dh-systemd init-system-helpers pkg-config asciidoc xmlto apg libpcre3-dev
dpkg-buildpackage -b -us -uc -i
cd ..
sudo dpkg -i shadowsocks-libev*.deb
```

配置文件格式

```
{
    "server":"servier_ip",
    "server_port":8388,
    "password":"password",
    "timeout":60,
    "method":"rc4-md5"
}
```

启动

```
ss-server -c config.json -f /tmp/ss.pid
```
## 使用supervisor托管
参考 <https://blog.phpgao.com/supervisor_shadowsocks.html>
### 安装
```
pip install supervisor
// 或者
easy_install supervisor
```
### 初始化
```
# 初始化配置文件
# 此命令会在 /etc/下创建一个示例配置文件
echo_supervisord_conf > /etc/supervisord.conf
```
### 配置
```
# 在/etc/supervisord.conf文件最后添加shadowsocks实例，代码如下
# 这一段配置如果配置错误，会导致supervisor的启动失败

[program:shadowsocks]
command = ss-server -c /home/gzm/config2.json
user = user
autostart = true
autoresart = true
stderr_logfile = /var/log/supervisor/ss.stderr.log
stdout_logfile = /var/log/supervisor/ss.stdout.log
```
### 更新和运行
```
# 运行的时候使用-c指定配置文件
supervisord -c /etc/supervisord.conf
# 如果不指定配置文件
supervisord

# 那么配置文件会依次再下面的文件夹中寻找
# $CWD/supervisord.conf
# $CWD/etc/supervisord.conf
# /etc/supervisord.conf
```
### 在web查看
```
# 在配置文件后加上服务器配置信息
[inet_http_server]
port = 127.0.0.1:9001
username = user
password = 123

# 最后不要忘了reload使之生效！
supervisorctl reload
```
如果将回环地址127.0.0.1换为服务器的IP地址，就可以可以远程管理supervisor了