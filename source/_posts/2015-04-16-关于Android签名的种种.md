---
layout: post
date: 2015-04-16 
title: 关于Android签名的种种
tags: 
    - Android
category: Android
---
创建一个新的证书
```bash
$ keytool -genkeypair -alias "test" -keyalg "RSA" -keystore "test.keystore"
Enter keystore password:
Re-enter new password:
What is your first and last name?
  [Unknown]:  张三
What is the name of your organizational unit?
  [Unknown]:  www.zhansan.com
What is the name of your organization?
  [Unknown]:  www.zhansan.com
What is the name of your City or Locality?
  [Unknown]:  Beijing
What is the name of your State or Province?
  [Unknown]:  Beijing
What is the two-letter country code for this unit?
  [Unknown]:  CN
Is CN=张三, OU=www.zhansan.com, O=www.zhansan.com, L=Beijing, ST=Beijing, C=CN correct?
  [no]:  y

Enter key password for <test>
    (RETURN if same as keystore password):
```

-genkeypair：生成一对非对称密钥;
-alias：指定密钥对的别名，该别名是公开的;
-keyalg：指定加密算法，本例中的采用通用的RAS加密算法;
-keystore:密钥库的路径及名称，不指定的话，默认在操作系统的用户目录下生成一个".keystore"的文件

查看证书库
```bash
 keytool -list -keystore test.keystore
Enter keystore password:

Keystore type: JKS
Keystore provider: SUN

Your keystore contains 1 entry

test, Apr 16, 2015, PrivateKeyEntry,
Certificate fingerprint (SHA1): 88:AB:10:48:04:9E:2A:71:10:BD:1E:94:83:80:67:16:01:E2:47:11
```

导出到证书文件
```bash
$ keytool -export -alias test -file test.crt -keystore test.keystore
Enter keystore password:
Certificate stored in file <test.crt>
```

导入证书文件
```bash
$ keytool -import -keystore test.keystore -file test.crt
Enter keystore password:
Certificate already exists in keystore under alias <test>
Do you still want to add it? [no]:  y
Certificate was added to keystore
```

查看证书的信息
```bash
$ keytool -printcert -file "test.crt"
Owner: CN=张三, OU=www.zhansan.com, O=www.zhansan.com, L=Beijing, ST=Beijing, C=CN
Issuer: CN=张三, OU=www.zhansan.com, O=www.zhansan.com, L=Beijing, ST=Beijing, C=CN
Serial number: 5f6822b2
Valid from: Thu Apr 16 12:37:01 CST 2015 until: Wed Jul 15 12:37:01 CST 2015
Certificate fingerprints:
     MD5:  0C:4C:4F:8C:5D:65:89:0E:05:E4:F1:2B:EE:E2:A6:96
     SHA1: 88:AB:10:48:04:9E:2A:71:10:BD:1E:94:83:80:67:16:01:E2:47:11
     SHA256: 08:25:05:C9:5A:9E:6A:94:DB:69:37:29:45:5F:E7:AE:F2:91:06:AE:43:DA:87:7A:75:1F:FA:CB:7A:C2:94:30
     Signature algorithm name: SHA256withRSA
     Version: 3

Extensions:

#1: ObjectId: 2.5.29.14 Criticality=false
SubjectKeyIdentifier [
KeyIdentifier [
0000: 72 73 55 78 1D 5F 6E 39   D4 D7 ED 3E 5C 2F B7 32  rsUx._n9...>\/.2
0010: E6 E2 AD 45                                        ...E
]
]
```

删除一个条目
```bash
$ keytool -delete -keystore test.keystore -alias test
```

有时候如果App中集成了微博或者微信等分享功能，使用的时候会验证App的签名，如果想要在Eclipse中调试的时候也能进行分享，就需要将生产证书修改为调试证书。调试证书的alias为androiddebugkey，密码为android
修改证书别名
```bash
$ keytool -changealias -alias test -destalias androiddebugkey -keystore test.keystore
```

结果如下
```bash
$ keytool -list -keystore test.keystore
Enter keystore password:

Keystore type: JKS
Keystore provider: SUN

Your keystore contains 1 entry

androiddebugkey, Apr 16, 2015, PrivateKeyEntry,
Certificate fingerprint (SHA1): ED:7D:96:5E:A8:C1:D7:4F:42:97:91:A4:57:BC:44:82:65:65:18:14
```

修改证书密码
```bash
$ keytool -keypasswd -alias androiddebugkey -keypass 234567 -new android -storepass 123456 -keystore test.keystore
```

修改证书库密码
```bash
$ keytool -storepasswd -storepass 123456 -new android -keystore test.keystore
```

签名apk
```bash
$ jarsigher -verbose -keystore test.keystore test.apk test
```
